<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Accounting for covariate in functional fine-mapping • fsusieR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Accounting for covariate in functional fine-mapping">
<meta property="og:description" content="fsusieR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fsusieR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/stephenslab/susiF.alpha" class="external-link">Source</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Accounting for covariate in functional
fine-mapping</h1>
                        <h4 data-toc-skip class="author">William R.P.
Denault</h4>
            
            <h4 data-toc-skip class="date">2024-06-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/stephenslab/fsusieR/blob/HEAD/vignettes/Adjusting_covariate.Rmd" class="external-link"><code>vignettes/Adjusting_covariate.Rmd</code></a></small>
      <div class="hidden name"><code>Adjusting_covariate.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="adjustment-for-functional-fine-mapping">Adjustment for functional fine-mapping<a class="anchor" aria-label="anchor" href="#adjustment-for-functional-fine-mapping"></a>
</h2>
<p>In order to reduce the number of false positives in fine-mapping
analysis, it is often important to account for potential confounders. As
most of the tools in the SuSiE suite don’t account for confounders while
performing fine-mapping, it is important to account for confounders
prior to the analysis. A similar problem arises with fSuSiE. While it is
relatively straightforward to adjust univariate phenotypes. It is more
complicated to adjust curves/profiles for confounding. Thus, we
implemented a user-friendly function that performs this preprocessing
step.</p>
<div class="section level3">
<h3 id="generating-the-data">Generating the data<a class="anchor" aria-label="anchor" href="#generating-the-data"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span></span>
<span>    echo <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    message <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    warning <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/stephenslab/fsusieR" class="external-link">fsusieR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/stephenslab/susieR" class="external-link">susieR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">wavethresh</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: MASS</span></span>
<span><span class="co">#&gt; WaveThresh: R wavelet software, release 4.7.2, installed</span></span>
<span><span class="co">#&gt; Copyright Guy Nason and others 1993-2022</span></span>
<span><span class="co">#&gt; Note: nlevels has been renamed to nlevelsWT</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">N3finemapping</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/attach.html" class="external-link">attach</a></span><span class="op">(</span><span class="va">N3finemapping</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rsnr</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co">#expected root signal noise ratio</span></span>
<span></span>
<span><span class="va">pos1</span> <span class="op">&lt;-</span> <span class="fl">25</span>   <span class="co">#Position of the causal covariate for effect 1</span></span>
<span><span class="va">pos2</span> <span class="op">&lt;-</span> <span class="fl">75</span>   <span class="co">#Position of the causal covariate for effect 2</span></span>
<span><span class="va">lev_res</span> <span class="op">&lt;-</span> <span class="fl">7</span><span class="co">#length of the molecular phenotype (2^lev_res)</span></span>
<span><span class="va">f1</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/simu_IBSS_per_level.html">simu_IBSS_per_level</a></span><span class="op">(</span><span class="va">lev_res</span> <span class="op">)</span><span class="op">$</span><span class="va">sim_func</span><span class="co">#first effect</span></span>
<span><span class="va">f2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simu_IBSS_per_level.html">simu_IBSS_per_level</a></span><span class="op">(</span><span class="va">lev_res</span> <span class="op">)</span><span class="op">$</span><span class="va">sim_func</span> <span class="co">#second effect</span></span>
<span></span>
<span><span class="va">f1_cov</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simu_IBSS_per_level.html">simu_IBSS_per_level</a></span><span class="op">(</span><span class="va">lev_res</span> <span class="op">)</span><span class="op">$</span><span class="va">sim_func</span> <span class="co">#effect cov 1</span></span>
<span><span class="va">f2_cov</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simu_IBSS_per_level.html">simu_IBSS_per_level</a></span><span class="op">(</span><span class="va">lev_res</span> <span class="op">)</span><span class="op">$</span><span class="va">sim_func</span> <span class="co">#effect cov 2</span></span>
<span><span class="va">f3_cov</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simu_IBSS_per_level.html">simu_IBSS_per_level</a></span><span class="op">(</span><span class="va">lev_res</span> <span class="op">)</span><span class="op">$</span><span class="va">sim_func</span> <span class="co">#effect cov 3</span></span>
<span></span>
<span> </span></code></pre></div>
<p>Here, the observed data is a mixture of technical noise and genotype
signal (target.data). Our goal is to remove the technical noise.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">Geno</span> <span class="op">&lt;-</span> <span class="va">N3finemapping</span><span class="op">$</span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span></span>
<span><span class="va">tt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/svd.html" class="external-link">svd</a></span><span class="op">(</span><span class="va">N3finemapping</span><span class="op">$</span><span class="va">X</span><span class="op">[</span>,<span class="fl">500</span><span class="op">:</span><span class="fl">700</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">3</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Geno</span> <span class="op">)</span>,sd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">target.data</span>  <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">noisy.data</span>  <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Geno</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">f1_obs</span> <span class="op">&lt;-</span> <span class="va">f1</span></span>
<span>  <span class="va">f2_obs</span> <span class="op">&lt;-</span> <span class="va">f2</span></span>
<span>  <span class="va">noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">f1</span><span class="op">)</span>, sd<span class="op">=</span>  <span class="op">(</span><span class="fl">1</span><span class="op">/</span>  <span class="va">rsnr</span> <span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">f1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">target.data</span> <span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">Geno</span> <span class="op">[</span><span class="va">i</span>,<span class="va">pos1</span><span class="op">]</span><span class="op">*</span><span class="va">f1_obs</span> <span class="op">+</span><span class="va">noise</span> <span class="op">+</span><span class="va">Geno</span> <span class="op">[</span><span class="va">i</span>,<span class="va">pos2</span><span class="op">]</span><span class="op">*</span><span class="va">f2_obs</span> </span>
<span>  <span class="va">noisy.data</span> <span class="op">[[</span> <span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span>   <span class="va">Cov</span> <span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">f1_cov</span>  <span class="op">+</span> <span class="va">Cov</span>  <span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">f2_cov</span> <span class="op">+</span> <span class="va">Cov</span>  <span class="op">[</span><span class="va">i</span>,<span class="fl">3</span><span class="op">]</span><span class="op">*</span><span class="va">f3_cov</span></span>
<span></span>
<span><span class="op">}</span></span>
<span><span class="va">technical.noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">noisy.data</span><span class="op">)</span></span>
<span><span class="va">target.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">target.data</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">technical.noise</span><span class="op">+</span><span class="va">target.data</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="account-for-covariates">Account for covariates<a class="anchor" aria-label="anchor" href="#account-for-covariates"></a>
</h3>
<p>We use the function to regress out the effect of the covariate (in
the matrix Cov). The function outputs an object that contains * the
adjusted curves * the fitted effect (covariate) * the corresponding
position for the mapped adjusted curves and fitted curves</p>
<p>NB: If you input matrix Y has a number of columns that is not a power
of 2. Then will remap the corresponding curves to a grid with <span class="math inline">\(2^K\)</span> points. Note that if the
corresponding positions of the columns are not evenly spaced, then it is
important to provide these positions in the pos argument. The output
provides the adjusted curves and the fitted effect matrices mapped on
the grid provided in the pos entry</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">Est_effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EBmvFR.html">EBmvFR</a></span><span class="op">(</span><span class="va">Y</span>,X<span class="op">=</span><span class="va">Cov</span>,adjust<span class="op">=</span><span class="cn">TRUE</span> <span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Starting initialization"</span></span>
<span><span class="co">#&gt; [1] "Discarding  0 wavelet coefficients out of  128"</span></span>
<span><span class="co">#&gt; [1] "Initialization done"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  1 , iter 1"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  2 , iter 1"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  3 , iter 1"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  1 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  2 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  3 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  1 , iter 3"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  2 , iter 3"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  3 , iter 3"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  1 , iter 4"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  2 , iter 4"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  3 , iter 4"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Est_effect</span><span class="op">$</span><span class="va">fitted_func</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>,type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>     col<span class="op">=</span><span class="st">"blue"</span>,</span>
<span>     lty<span class="op">=</span><span class="fl">2</span>,</span>
<span>     lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">f1_cov</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">60</span>,y<span class="op">=</span><span class="op">-</span><span class="fl">1</span>,</span>
<span>       lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>       lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>       legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'effect'</span>,<span class="st">'estimated'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="Adjusting_covariate_files/figure-html/unnamed-chunk-3-1.png" alt="&amp;nbsp;" width="875"><p class="caption">
 
</p>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span></span>
<span><span class="va">Y_corrected</span>  <span class="op">&lt;-</span><span class="va">Est_effect</span><span class="op">$</span><span class="va">Y_adjusted</span></span></code></pre></div>
<p>You can also perform the adjustment yourself by accessing the fitted
curves directly (and potentially only removing the effect you are
interested in)</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>  <span class="va">Y_corrected</span>, <span class="va">Y</span><span class="op">-</span><span class="va">Cov</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span><span class="va">Est_effect</span><span class="op">$</span><span class="va">fitted_func</span> <span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="Adjusting_covariate_files/figure-html/unnamed-chunk-4-1.png" alt="&amp;nbsp;" width="875"><p class="caption">
 
</p>
</div>
<p>Here, you can see that the corrected data closely matches the actual
underlying signals.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">Y</span> , <span class="va">target.data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">Y_corrected</span> , <span class="va">target.data</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="Adjusting_covariate_files/figure-html/unnamed-chunk-5-1.png" alt="&amp;nbsp;" width="875"><p class="caption">
 
</p>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fine-map">Fine-map<a class="anchor" aria-label="anchor" href="#fine-map"></a>
</h3>
<p>We can now fine-map our curves without to be worried of potential
confounding due to population stratification or age</p>
<pre><code><span><span class="co">#&gt; [1] "Starting initialization"</span></span>
<span><span class="co">#&gt; [1] "Data transform"</span></span>
<span><span class="co">#&gt; [1] "Discarding  0 wavelet coefficients out of  128"</span></span>
<span><span class="co">#&gt; [1] "Data transform done"</span></span>
<span><span class="co">#&gt; [1] "Initializing prior"</span></span>
<span><span class="co">#&gt; [1] "Initialization done"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  1 , iter 1"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  2 , iter 1"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  3 , iter 1"</span></span>
<span><span class="co">#&gt; [1] "Adding  7  extra effects"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  1 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  2 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  3 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  4 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  5 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  6 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  7 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  8 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  9 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  10 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Discarding  8  effects"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  1 , iter 3"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  2 , iter 3"</span></span>
<span><span class="co">#&gt; [1] "Discarding  8  effects"</span></span>
<span><span class="co">#&gt; [1] "Greedy search and backfitting done"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  1 , iter 4"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  2 , iter 4"</span></span>
<span><span class="co">#&gt; [1] "Fine mapping done, refining effect estimates using cylce spinning wavelet transform"</span></span></code></pre>
<p>We can check the results</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> </span>
<span> <span class="fu"><a href="../reference/plot_susiF.html">plot_susiF</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="Adjusting_covariate_files/figure-html/unnamed-chunk-7-1.png" alt="&amp;nbsp;" width="875"><p class="caption">
 
</p>
</div>
<div class="figure" style="text-align: center">
<img src="Adjusting_covariate_files/figure-html/unnamed-chunk-7-2.png" alt="&amp;nbsp;" width="875"><p class="caption">
 
</p>
</div>
<p>### Comparison with fine-mapping without adjustment</p>
<p>We can compare the performance when not adjusting.</p>
<pre><code><span><span class="co">#&gt; [1] "Starting initialization"</span></span>
<span><span class="co">#&gt; [1] "Data transform"</span></span>
<span><span class="co">#&gt; [1] "Discarding  0 wavelet coefficients out of  128"</span></span>
<span><span class="co">#&gt; [1] "Data transform done"</span></span>
<span><span class="co">#&gt; [1] "Initializing prior"</span></span>
<span><span class="co">#&gt; [1] "Initialization done"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  1 , iter 1"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  2 , iter 1"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  3 , iter 1"</span></span>
<span><span class="co">#&gt; [1] "Adding  7  extra effects"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  1 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  2 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  3 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  4 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  5 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  6 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  7 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  8 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  9 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  10 , iter 2"</span></span>
<span><span class="co">#&gt; [1] "Discarding  8  effects"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  1 , iter 3"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  2 , iter 3"</span></span>
<span><span class="co">#&gt; [1] "Discarding  8  effects"</span></span>
<span><span class="co">#&gt; [1] "Greedy search and backfitting done"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  1 , iter 4"</span></span>
<span><span class="co">#&gt; [1] "Fitting effect  2 , iter 4"</span></span>
<span><span class="co">#&gt; [1] "Fine mapping done, refining effect estimates using cylce spinning wavelet transform"</span></span></code></pre>
<p>Here we can see the performance.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> </span>
<span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">f1</span>, type<span class="op">=</span><span class="st">"l"</span>, main<span class="op">=</span><span class="st">"Estimated effect 1"</span>, xlab<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_fitted_effect.html">get_fitted_effect</a></span><span class="op">(</span><span class="va">out</span>,l<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'blue'</span> <span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_fitted_effect.html">get_fitted_effect</a></span><span class="op">(</span><span class="va">out_unadj</span>,l<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'blue'</span> , lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span> </span>
<span> <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x<span class="op">=</span> <span class="fl">20</span>,</span>
<span>        y<span class="op">=</span><span class="op">-</span><span class="fl">0.5</span>,</span>
<span>        lty<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>        legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"effect 1"</span>,<span class="st">"fSuSiE ajd"</span>, <span class="st">"fSuSiE unajd "</span> <span class="op">)</span>,</span>
<span>        col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="st">"blue"</span>,<span class="st">"blue"</span> <span class="op">)</span></span>
<span> <span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="Adjusting_covariate_files/figure-html/unnamed-chunk-9-1.png" alt="&amp;nbsp;" width="875"><p class="caption">
 
</p>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">f2</span>, type<span class="op">=</span><span class="st">"l"</span>, main<span class="op">=</span><span class="st">"Estimated effect 2"</span>, xlab<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_fitted_effect.html">get_fitted_effect</a></span><span class="op">(</span><span class="va">out</span>,l<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'darkgreen'</span> <span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_fitted_effect.html">get_fitted_effect</a></span><span class="op">(</span><span class="va">out_unadj</span>,l<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'darkgreen'</span> , lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span> </span>
<span> <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x<span class="op">=</span> <span class="fl">10</span>,</span>
<span>        y<span class="op">=</span><span class="fl">2.5</span>,</span>
<span>        lty<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,</span>
<span>        legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"effect 1"</span>,<span class="st">"fSuSiE ajd"</span>, <span class="st">"fSuSiE unajd "</span> <span class="op">)</span>,</span>
<span>        col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="st">"darkgreen"</span>,<span class="st">"darkgreen"</span> <span class="op">)</span></span>
<span> <span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="Adjusting_covariate_files/figure-html/unnamed-chunk-9-2.png" alt="&amp;nbsp;" width="875"><p class="caption">
 
</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by William R. P. Denault.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
