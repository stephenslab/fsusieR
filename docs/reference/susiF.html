<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Sum of Single Function — susiF • fsusieR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Sum of Single Function — susiF"><meta property="og:description" content="Implementation of the SuSiF method"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fsusieR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/stephenslab/susiF.alpha" class="external-link">Source</a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Sum of Single Function</h1>
    <small class="dont-index">Source: <a href="https://github.com/stephenslab/fsusieR/blob/HEAD/R/susiF.R" class="external-link"><code>R/susiF.R</code></a></small>
    <div class="hidden name"><code>susiF.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Implementation of the SuSiF method</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">susiF</span><span class="op">(</span></span>
<span>  <span class="va">Y</span>,</span>
<span>  <span class="va">X</span>,</span>
<span>  L <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  pos <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mixture_normal_per_scale"</span>, <span class="st">"mixture_normal"</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  maxit <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  cov_lev <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  min_purity <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  filter_cs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  init_pi0_w <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  nullweight <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  control_mixsqp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span>, eps <span class="op">=</span> <span class="fl">1e-06</span>, numiter.em <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>  thresh_lowcount <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  cal_obj <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  L_start <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  quantile_trans <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  greedy <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  backfit <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  gridmult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>  max_scale <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  max_SNP_EM <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  max_step_EM <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  cor_small <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  filter.number <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"DaubLeAsymm"</span>,</span>
<span>  post_processing <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TI"</span>, <span class="st">"HMM"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>  e <span class="op">=</span> <span class="fl">0.001</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>Y</dt>
<dd><p>functional phenotype, matrix of size N by size J. The
underlying algorithm uses wavelet, which assumes that J is of the
form J^2. If J is not a power of 2, susiF internally remaps the data
into a grid of length 2^J</p></dd>


<dt>X</dt>
<dd><p>matrix of size n by p contains the covariates</p></dd>


<dt>L</dt>
<dd><p>upper bound on the number of effects to fit (if not specified, set to =2)</p></dd>


<dt>pos</dt>
<dd><p>vector of length J, corresponding to position/time pf
the observed column in Y, if missing, suppose that the observation
are evenly spaced</p></dd>


<dt>prior</dt>
<dd><p>specify the prior used in susiF. The two available choices are
available "mixture_normal_per_scale", "mixture_normal". Default "mixture_normal_per_scale",
if this susiF is too slow, consider using  "mixture_normal"  using  "mixture_normal" which  is up to 40% faster but may lead to slight power loss</p></dd>


<dt>verbose</dt>
<dd><p>If <code>verbose = TRUE</code>, the algorithm's progress,
and a summary of the optimization settings are printed on the
console.</p></dd>


<dt>maxit</dt>
<dd><p>Maximum number of IBSS iterations.</p></dd>


<dt>tol</dt>
<dd><p>a small, non-negative number specifying the convergence
tolerance for the IBSS fitting procedure. The fitting procedure
will halt when the difference in the variational lower bound or
“ELBO” (the objective function to be maximized), is less
than <code>tol</code>.</p></dd>


<dt>cov_lev</dt>
<dd><p>numeric between 0 and 1, corresponding to the
expected level of coverage of the CS if not specified, set to 0.95</p></dd>


<dt>min_purity</dt>
<dd><p>minimum purity for estimated credible sets</p></dd>


<dt>filter_cs</dt>
<dd><p>logical, if TRUE filters the credible set (removing low-purity)
cs and cs with estimated prior equal to 0). Set as TRUE by default.</p></dd>


<dt>init_pi0_w</dt>
<dd><p>starting value of weight on null compoenent in mixsqp
(between 0 and 1)</p></dd>


<dt>nullweight</dt>
<dd><p>numeric value for penalizing likelihood at point mass 0 (should be between 0 and 1)
(useful in small sample size)</p></dd>


<dt>control_mixsqp</dt>
<dd><p>list of parameter for mixsqp function see  mixsqp package</p></dd>


<dt>thresh_lowcount</dt>
<dd><p>numeric, used to check the wavelet coefficients have
problematic distribution (very low dispersion even after standardization).
Basically, check if the median of the absolute value of the distribution of
 a wavelet coefficient is below this threshold. If yes, the algorithm discards
 this wavelet coefficient (setting its estimate effect to 0 and estimate sd to 1).
 Set to 0 by default. It can be useful when analyzing sparse data from sequence
  based assay or small samples.</p></dd>


<dt>cal_obj</dt>
<dd><p>logical if set as TRUE compute ELBO for convergence monitoring</p></dd>


<dt>L_start</dt>
<dd><p>number of effect initialized at the start of the algorithm</p></dd>


<dt>quantile_trans</dt>
<dd><p>logical, if set as TRUE perform normal quantile, transform
on wavelet coefficients</p></dd>


<dt>greedy</dt>
<dd><p>logical, if TRUE allows greedy search for extra effect
(up to L specified by the user). Set as TRUE by default</p></dd>


<dt>backfit</dt>
<dd><p>logical, if TRUE, allow discarding effect via back fitting.
Set as true by default as TRUE. We advise keeping it as TRUE.</p></dd>


<dt>gridmult</dt>
<dd><p>numeric used to control the number of components used in the mixture prior (see ashr package
for more details). From the ash function:  multiplier by which the default grid values for mixed differ from one another.
 (Smaller values produce finer grids.). Increasing this value may reduce computational time.</p></dd>


<dt>max_scale</dt>
<dd><p>numeric, define the maximum of wavelet coefficients used in the analysis (2^max_scale).
Set 10 true by default.</p></dd>


<dt>max_SNP_EM</dt>
<dd><p>maximum number of SNP used for learning the prior. By default, set to 1000. Reducing this may help reduce
the computational time. We advise to keep it at least larger than 50</p></dd>


<dt>max_step_EM</dt>
<dd><p>max_step_EM</p></dd>


<dt>cor_small</dt>
<dd><p>logical set to FALSE by default. If TRUE used the Bayes factor from Valen E Johnson JRSSB 2005 instead of Wakefield approximation for Gen Epi 2009
The Bayes factor from Valen E Johnson JRSSB 2005 tends to have better coverage in small sample sizes. We advise using this parameter if n&lt;50</p></dd>


<dt>filter.number</dt>
<dd><p>see documentation of wd from wavethresh package</p></dd>


<dt>family</dt>
<dd><p>see documentation of wd from wavethresh package</p></dd>


<dt>post_processing</dt>
<dd><p>character, use "TI" for translation invariant wavelet estimates,
"HMM" for hidden Markov model (useful for estimating non-zero regions),
"none" for simple wavelet estimate (not recommended)</p></dd>


<dt>e</dt>
<dd><p>threshold value is used to avoid computing posteriors that have low alpha values. Set it to 0 to compute the entire posterior. default value is 0.001</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A <code>"susiF"</code> object with some or all of the following elements:</p>
<dl><dt>alpha</dt>
<dd><p>a list of length L  containing the posterior inclusion probabilities for each effect.</p></dd>

<dt>pip</dt>
<dd><p>a vector of length J, containing the posterior inclusion probability of each covariate</p></dd>

<dt>cs</dt>
<dd><p>a list of length L, each element is the credible set of the lth effect</p></dd>

<dt>purity</dt>
<dd><p>a list of length L, each element is the purity of the lth effect</p></dd>

<dt>fitted_func</dt>
<dd><p>a list of length L, each element is a list of length J, containing the estimated effect of the Lth effect at each position</p></dd>

<dt>cred_band</dt>
<dd><p>a list of length L, each element is a list of length J, containing the credible band of the Lth effect at each position</p></dd>

<dt>sigma2 </dt>
<dd><p>The estimated residual variance</p></dd>

<dt>lBF</dt>
<dd><p>a list of length L  containing the log  Bayes factor for each effect.</p></dd>

<dt> ind_fitted_func</dt>
<dd><p>a matrix of the individual estimated genotype effect</p></dd>

<dt>outin_grid</dt>
<dd><p>The grid on which the effects are estimated (see vignette introduction for more details)</p></dd>

<dt>runtime</dt>
<dd><p>runtime of the algorithm</p></dd>

<dt>G_prior</dt>
<dd><p>a list of of ash objects containning the prior mixture component</p></dd>

<dt>est_pi</dt>
<dd><p>a list  of length L, each element contains the estimated  prior mixture  weights for each effect</p></dd>

<dt>est_sd</dt>
<dd><p>the estimated prior mixture for each effect</p></dd>

<dt>ELBO</dt>
<dd><p>the ELBO value at each iteration of the algorithm</p></dd>

<dt>fitted_wc</dt>
<dd><p>a list of length L, each element is a list of length J, containing the conditional wavelet coefficients first moment for Lth effect. Note that this is only for internal use in the IBSS and
       the results in  fitted_func  will corresponds to this wavelet coefficient if  <code>post_processing</code> is set to <code>none</code>, not recommended.</p></dd>

<dt>fitted_wc2</dt>
<dd><p>a list of length L, each element is a list of length J, containing the conditional wavelet coefficients second-moment for the Lth effect.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>Implementation of the SuSiF method</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/stephens999/ashr" class="external-link">ashr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">wavethresh</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#Example using curves simulated under the Mixture normal per scale prior</span></span></span>
<span class="r-in"><span><span class="va">rsnr</span> <span class="op">&lt;-</span> <span class="fl">0.2</span> <span class="co">#expected root signal noise ratio</span></span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span>    <span class="co">#Number of individuals</span></span></span>
<span class="r-in"><span><span class="va">P</span> <span class="op">&lt;-</span> <span class="fl">100</span>     <span class="co">#Number of covariates/SNP</span></span></span>
<span class="r-in"><span><span class="va">pos1</span> <span class="op">&lt;-</span> <span class="fl">1</span>   <span class="co">#Position of the causal covariate for effect 1</span></span></span>
<span class="r-in"><span><span class="va">pos2</span> <span class="op">&lt;-</span> <span class="fl">5</span>   <span class="co">#Position of the causal covariate for effect 2</span></span></span>
<span class="r-in"><span><span class="va">lev_res</span> <span class="op">&lt;-</span> <span class="fl">7</span><span class="co">#length of the molecular phenotype (2^lev_res)</span></span></span>
<span class="r-in"><span><span class="va">f1</span> <span class="op">&lt;-</span>  <span class="fu"><a href="simu_IBSS_per_level.html">simu_IBSS_per_level</a></span><span class="op">(</span><span class="va">lev_res</span> <span class="op">)</span><span class="op">$</span><span class="va">sim_func</span><span class="co">#first effect</span></span></span>
<span class="r-in"><span><span class="va">f2</span> <span class="op">&lt;-</span> <span class="fu"><a href="simu_IBSS_per_level.html">simu_IBSS_per_level</a></span><span class="op">(</span><span class="va">lev_res</span> <span class="op">)</span><span class="op">$</span><span class="va">sim_func</span> <span class="co">#second effect</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">f1</span>, type <span class="op">=</span><span class="st">"l"</span>, ylab<span class="op">=</span><span class="st">"effect"</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">f2</span>, type<span class="op">=</span><span class="st">"l"</span>, col<span class="op">=</span><span class="st">"green"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">100</span>,</span></span>
<span class="r-in"><span>      y<span class="op">=</span><span class="fl">3</span>,</span></span>
<span class="r-in"><span>      lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      legend<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"effect 1"</span>, <span class="st">"effect 2"</span> <span class="op">)</span>,</span></span>
<span class="r-in"><span>      col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="st">"blue"</span>,<span class="st">"yellow"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="susiF-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">G</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, size<span class="op">=</span><span class="va">N</span><span class="op">*</span><span class="va">P</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, nrow<span class="op">=</span><span class="va">N</span>, ncol<span class="op">=</span><span class="va">P</span><span class="op">)</span> <span class="co">#Genotype</span></span></span>
<span class="r-in"><span><span class="va">beta0</span>       <span class="op">&lt;-</span> <span class="fl">0</span></span></span>
<span class="r-in"><span><span class="va">beta1</span>       <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">beta2</span>       <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">noisy.data</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">{</span></span></span>
<span class="r-in"><span> <span class="va">f1_obs</span> <span class="op">&lt;-</span> <span class="va">f1</span></span></span>
<span class="r-in"><span> <span class="va">f2_obs</span> <span class="op">&lt;-</span> <span class="va">f2</span></span></span>
<span class="r-in"><span> <span class="va">noise</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">f1</span><span class="op">)</span>, sd<span class="op">=</span>  <span class="op">(</span><span class="fl">1</span><span class="op">/</span>  <span class="va">rsnr</span> <span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">f1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">noisy.data</span> <span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span>   <span class="va">beta1</span><span class="op">*</span><span class="va">G</span><span class="op">[</span><span class="va">i</span>,<span class="va">pos1</span><span class="op">]</span><span class="op">*</span><span class="va">f1_obs</span> <span class="op">+</span> <span class="va">beta2</span><span class="op">*</span><span class="va">G</span><span class="op">[</span><span class="va">i</span>,<span class="va">pos2</span><span class="op">]</span><span class="op">*</span><span class="va">f2_obs</span> <span class="op">+</span> <span class="va">noise</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">noisy.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">noisy.data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">noisy.data</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, col<span class="op">=</span><span class="op">(</span><span class="va">G</span><span class="op">[</span><span class="fl">1</span>, <span class="va">pos1</span><span class="op">]</span><span class="op">*</span><span class="fl">3</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     main <span class="op">=</span><span class="st">"Observed curves \n   colored by the causal effect"</span> , ylim<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">40</span>,<span class="fl">40</span><span class="op">)</span>, xlab<span class="op">=</span><span class="st">""</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span> <span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">{</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span> <span class="va">noisy.data</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, col<span class="op">=</span><span class="op">(</span><span class="va">G</span><span class="op">[</span><span class="va">i</span>, <span class="va">pos1</span><span class="op">]</span><span class="op">*</span><span class="fl">3</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">0.3</span>,</span></span>
<span class="r-in"><span>      y<span class="op">=</span><span class="op">-</span><span class="fl">10</span>,</span></span>
<span class="r-in"><span>      lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      legend<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1"</span>,<span class="st">"2"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="st">"blue"</span>,<span class="st">"yellow"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="susiF-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">noisy.data</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">G</span></span></span>
<span class="r-in"><span><span class="co">#Running fSuSiE</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">susiF</span><span class="op">(</span><span class="va">Y</span>,<span class="va">X</span>,L<span class="op">=</span><span class="fl">2</span> , prior <span class="op">=</span> <span class="st">'mixture_normal_per_scale'</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Starting initialization"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Data transform"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Discarding  0 wavelet coefficients out of  128"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Data transform done"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Initializing prior"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Initialization done"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Fitting effect  1 , iter 1"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Fitting effect  2 , iter 1"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Discarding  0  effects"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Greedy search and backfitting done"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Fitting effect  1 , iter 2"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Fitting effect  2 , iter 2"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Fine mapping done, refining effect estimates using cylce spinning wavelet transform"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_susiF.html">plot_susiF</a></span><span class="op">(</span><span class="va">out</span>, cred.band <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="susiF-3.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="susiF-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Find out which regions are affected by the different CS</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="affected_reg.html">affected_reg</a></span><span class="op">(</span>obj <span class="op">=</span> <span class="va">out</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    CS Start End</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   1    42  43</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6   1    45  46</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7   1    60  60</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8   1    62  76</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   1    90  90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   1    94  94</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   1   111 118</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   1   125 125</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10  2     1  13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11  2    29  38</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9   2    48  80</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12  2   128 128</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># This corresponds to the regions where the credible bands are</span></span></span>
<span class="r-in"><span><span class="co"># "crossing zero"/i.e. the effects are likely not to be 0 in this</span></span></span>
<span class="r-in"><span><span class="co"># region.</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># You can also access the information directly in the output of</span></span></span>
<span class="r-in"><span><span class="co"># susiF as follows.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">f2</span>, type<span class="op">=</span><span class="st">"l"</span>, main<span class="op">=</span><span class="st">"Estimated effect 1"</span>, xlab<span class="op">=</span><span class="st">""</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">fitted_func</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'blue'</span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">cred_band</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'darkblue'</span>,lty<span class="op">=</span><span class="fl">2</span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">cred_band</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'darkblue'</span> ,lty<span class="op">=</span><span class="fl">2</span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">0</span>,b<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x<span class="op">=</span> <span class="fl">35</span>,</span></span>
<span class="r-in"><span>      y<span class="op">=</span><span class="fl">3</span>,</span></span>
<span class="r-in"><span>      lty<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"effect 1"</span>,<span class="st">" fSuSiE est "</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="st">"blue"</span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">f1</span>, type<span class="op">=</span><span class="st">"l"</span>, main<span class="op">=</span><span class="st">"Estimated effect 2"</span>, xlab<span class="op">=</span><span class="st">""</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">fitted_func</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'darkgreen'</span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">cred_band</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'darkgreen'</span>,lty<span class="op">=</span><span class="fl">2</span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">cred_band</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'darkgreen'</span> ,lty<span class="op">=</span><span class="fl">2</span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#'abline(a=0,b=0)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x<span class="op">=</span> <span class="fl">20</span>,</span></span>
<span class="r-in"><span>      y<span class="op">=</span><span class="op">-</span><span class="fl">1.5</span>,</span></span>
<span class="r-in"><span>      lty<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"effect 2"</span>,<span class="st">" fSuSiE est "</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>      col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="st">"green"</span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="susiF-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by William R. P. Denault.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

